{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "",
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Network Configuration"
          },
          "Parameters": [
            "VPC",
            "SubnetDBA",
            "SubnetDBB"
          ]
        },
        {
          "Label": {
            "default": "Security Configuration"
          },
          "Parameters": [
            "DBSecurityGroup"
          ]
        },
        {
          "Label": {
            "default": "Database Configuration"
          },
          "Parameters": [
            "MasterUserPassword",
            "MasterUsername"
          ]
        }
      ]
    }
  },
  "Parameters": {
    "DBSecurityGroup": {
      "Description": "-",
      "Type": "String",
      "Default": "-"
    },
    "SubnetDBA": {
      "Description": "-",
      "Type": "String",
      "Default": "-"
    },
    "SubnetDBB": {
      "Description": "-",
      "Type": "String",
      "Default": "-"
    },
    "MasterUserPassword": {
      "Description": "-",
      "Type": "String",
      "Default": "-"
    },
    "MasterUsername": {
      "Description": "-",
      "Type": "String",
      "Default": "-"
    }
  },
  "Mappings": {},
  "Conditions": {},
  "Resources": {
    "rdsDBInstance": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "AllocatedStorage": 20,
        "DBInstanceClass": "db.t3.micro",
        "AllowMajorVersionUpgrade": "true",
        "AutoMinorVersionUpgrade": "true",
        "DBInstanceIdentifier": "CerberoDB",
        "DBName": "CoreDB",
        "VPCSecurityGroups": [
          {
            "Ref": "DBSecurityGroup"
          }
        ],
        "DBSubnetGroupName": {
          "Ref": "rdsDBSubnetGroup"
        },
        "Engine": "postgres",
        "EngineVersion": "12.4",
        "MasterUsername": {
          "Ref": "MasterUsername"
        },
        "MasterUserPassword": {
          "Ref": "MasterUserPassword"
        },
        "MultiAZ": true,
        "Port": "5432",
        "PubliclyAccessible": false,
        "StorageEncrypted": false,
        "StorageType": "gp2"
      }
    },
    "rdsDBSubnetGroup": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "DBSubnetGroupDescription": "Subnet group for rds postgres Cerbero",
        "SubnetIds": [
          {
            "Ref": "SubnetDBA"
          },
          {
            "Ref": "SubnetDBB"
          }
        ]
      }
    }
  },
  "Outputs": {
    
    "rdsDBSubnetGroup" : {
      "Value" : 
      { "Ref": "rdsDBSubnetGroup" }
      
    },
    "rdsDBInstance" : {
      "Value" : 
      { "Ref": "rdsDBInstance" }
      
    },
    "rdsendpoint" : {
      "Value" : 
      { "Fn::GetAtt" : [ "rdsDBInstance", "Endpoint.Address" ]}
      
      
    }
    
    
  }
}